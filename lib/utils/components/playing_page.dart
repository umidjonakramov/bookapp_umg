// import 'package:audioplayers/audioplayers.dart';// import 'package:flutter/material.dart';// import 'package:flutter_bloc/flutter_bloc.dart';// import 'package:shimmer/shimmer.dart';// import '../../../data/local/shared_preferences.dart';// import '../../../data/param/book_data.dart';// import '../../../domain/repository/app_repository.dart';// import '../../../domain/repository/impl/app_repository_impl.dart';// import '../../../utils/utils.dart';// import '../document_viewer/document_viewer_page.dart';// import '../home/home_page.dart';// import 'bloc/playing_bloc.dart';//// class PlayingPage extends StatefulWidget {//   final String currentId;////   const PlayingPage(this.currentId, {super.key});////   @override//   State<PlayingPage> createState() => _PlayingPageState();// }//// class _PlayingPageState extends State<PlayingPage> {//   late PlayingBloc _playingBloc;//   BookData? currentBook;//   final AppRepository _repository = AppRepositoryImpl();//   final AudioPlayer _audioPlayer = AudioPlayer();//   Duration _duration = Duration.zero;//   Duration _position = Duration.zero;//   bool _isPlaying = false;////   @override//   void initState() {//     super.initState();//     _playingBloc = PlayingBloc()..add(GetBookByIdEvent(widget.currentId));////     _audioPlayer.onDurationChanged.listen((newDuration) {//       setState(() => _duration = newDuration);//     });////     _audioPlayer.onPositionChanged.listen((newPosition) {//       setState(() => _position = newPosition);//     });////     _isPlaying = true;//   }////   @override//   void dispose() {//     _playingBloc.close();//     _audioPlayer.dispose();//     super.dispose();//   }////   @override//   Widget build(BuildContext context) {//     return BlocProvider(//       create: (context) => _playingBloc,//       child: BlocConsumer<PlayingBloc, PlayingState>(//         listener: (context, state) {//           if (state is GetBookByIdState) {//             setState(() {//               currentBook = state.book;////               if (currentBook != null &&//                   currentBook!.audio != null &&//                   currentBook!.audio!.isNotEmpty &&//                   _isPlaying == true) {//                 _repository//                     .getAudioDownloadURL(currentBook!.audio![0])//                     .then((url) {//                   _audioPlayer.play(UrlSource(url));//                 }).catchError((error) {//                   print('Error playing audio: $error');//                 });//               }//             });//           }////           if (state is OpenBookFileState) {//             Navigator.push(//                 context,//                 MaterialPageRoute(//                     builder: (context) => DocumentViewerPage(book: state.url)));//           }//         },//         builder: (context, state) {//           return Scaffold(//             body: Stack(//               children: [//                 Container(//                   child: Image.asset("assets/images/oval.png"),//                 ),//                 SafeArea(//                   child: Padding(//                     padding: const EdgeInsets.all(17.0),//                     child: Column(//                       children: [//                         Row(//                           children: [//                             InkWell(//                                 onTap: () {//                                   Navigator.pushReplacement(//                                     context,//                                     PageRouteBuilder(//                                       pageBuilder: (context, animation,//                                               secondaryAnimation) =>//                                           const HomePage(),//                                       transitionsBuilder: (context, animation,//                                           secondaryAnimation, child) {//                                         var begin = const Offset(-1.0, 0.0);//                                         var end = Offset.zero;//                                         var curve = Curves.easeInOut;////                                         var tween = Tween(//                                                 begin: begin, end: end)//                                             .chain(CurveTween(curve: curve));//                                         var offsetAnimation =//                                             animation.drive(tween);////                                         return SlideTransition(//                                           position: offsetAnimation,//                                           child: child,//                                         );//                                       },//                                     ),//                                   );//                                 },//                                 child: const Icon(Icons.arrow_back_rounded,//                                     color: Colors.white)),//                             const Spacer(),//                             const Text(//                               'Now Playing',//                               style: TextStyle(//                                 color: Colors.white,//                                 fontSize: 20,//                                 fontFamily: 'Uni Neue',//                                 fontWeight: FontWeight.w700,//                                 height: 0,//                               ),//                             ),//                             const Spacer(),//                             const Icon(Icons.more_vert, color: Colors.white)//                           ],//                         ),//                         const SizedBox(height: 40),//                         if (currentBook?.img != null)//                           InkWell(//                               onTap: () {//                                 context.read<PlayingBloc>().add(//                                     OpenBookFileEvent(currentBook?.book ?? ""));//                               },//                               child: Container(//                                 width: 193,//                                 height: 274,//                                 decoration: const BoxDecoration(//                                   boxShadow: [//                                     BoxShadow(//                                       color: Color(0x3F000000),//                                       blurRadius: 4,//                                       offset: Offset(4, 4),//                                       spreadRadius: 0,//                                     )//                                   ],//                                 ),//                                 child: Hero(//                                   tag: "${currentBook!.id}",//                                   child: ClipRRect(//                                       borderRadius://                                           const BorderRadiusDirectional.all(//                                               Radius.circular(10)),//                                       child: FutureBuilder<String>(//                                         future: _repository//                                             .getDownloadURL(currentBook!.img!),//                                         builder: (context, snapshot) {//                                           if (snapshot.hasData) {//                                             return Image.network(snapshot.data!,//                                                 fit: BoxFit.cover);//                                           } else {//                                             return const Icon(Icons.error);//                                           }//                                         },//                                       )),//                                 ),//                               ))//                         else//                           Container(//                             width: 193,//                             height: 274,//                             decoration: const BoxDecoration(//                               borderRadius: BorderRadiusDirectional.all(//                                   Radius.circular(10)),//                               boxShadow: [//                                 BoxShadow(//                                   color: Color(0x3F000000),//                                   blurRadius: 4,//                                   offset: Offset(4, 4),//                                   spreadRadius: 0,//                                 )//                               ],//                             ),//                             child: Shimmer.fromColors(//                                 baseColor: Colors.grey[300]!,//                                 highlightColor: Colors.grey[200]!,//                                 child: Container(//                                   color: Colors.grey,//                                 )),//                           ),//                         const SizedBox(height: 48),//                         if (currentBook?.title == null)//                           SizedBox(//                               width: 98,//                               height: 15,//                               child: Shimmer.fromColors(//                                   baseColor: Colors.grey[300]!,//                                   highlightColor: Colors.grey[200]!,//                                   child: Container(//                                     color: Colors.grey,//                                   )))//                         else//                           Text(//                             currentBook?.title ?? 'Loading...',//                             style: const TextStyle(//                               color: Color(0xFF787878),//                               fontSize: 14,//                               fontFamily: 'Uni Neue',//                               fontWeight: FontWeight.w500,//                               height: 0,//                             ),//                           ),//                         const SizedBox(height: 5),//                         if (currentBook?.author == null)//                           SizedBox(//                               width: 72,//                               height: 13,//                               child: Shimmer.fromColors(//                                   baseColor: Colors.grey[300]!,//                                   highlightColor: Colors.grey[200]!,//                                   child: Container(//                                     color: Colors.grey,//                                   )))//                         else//                           Text(//                             currentBook!.author!,//                             style: const TextStyle(//                               color: Color(0xFF787878),//                               fontSize: 12,//                               fontFamily: 'Uni Neue',//                               fontWeight: FontWeight.w700,//                               height: 0,//                             ),//                           ),//                         const SizedBox(height: 50),//                         Padding(//                           padding: const EdgeInsets.symmetric(horizontal: 28.0),//                           child: Row(//                             children: [//                               Text(//                                 formatDuration(_position),//                                 style: const TextStyle(//                                   color: Color(0xFF787878),//                                   fontSize: 14,//                                   fontFamily: 'Uni Neue',//                                   fontWeight: FontWeight.w500,//                                   height: 0,//                                 ),//                               ),//                               Expanded(//                                   child: Slider(//                                 activeColor: const Color(0xFFF26B6C),//                                 thumbColor: const Color(0xFFF26B6C),//                                 value: _position.inSeconds.toDouble(),//                                 max: _duration.inSeconds.toDouble(),//                                 onChanged: (value) {//                                   setState(() {//                                     _audioPlayer//                                         .seek(Duration(seconds: value.toInt()));//                                   });//                                 },//                               )),//                               Text(//                                 formatDuration(_duration),//                                 style: const TextStyle(//                                   color: Color(0xFF787878),//                                   fontSize: 14,//                                   fontFamily: 'Uni Neue',//                                   fontWeight: FontWeight.w500,//                                   height: 0,//                                 ),//                               )//                             ],//                           ),//                         ),//                         const SizedBox(height: 30),//                         Padding(//                           padding: const EdgeInsets.symmetric(horizontal: 28),//                           child: Row(//                             children: [//                               Image.asset("assets/icons/ic_prev.png",//                                   height: 16,//                                   width: 14,//                                   color: MyPreferences.getTheme() == true//                                       ? Colors.white//                                       : Colors.black),//                               const Spacer(),//                               InkWell(//                                 onTap: () {//                                   final newPosition =//                                       _position - const Duration(seconds: 10);//                                   _audioPlayer.seek(newPosition);//                                   setState(() {//                                     _position = newPosition;//                                   });//                                 },//                                 child: Image.asset("assets/icons/ic_less.png",//                                     height: 14,//                                     width: 20,//                                     color: MyPreferences.getTheme() == true//                                         ? Colors.white//                                         : Colors.black),//                               ),//                               const Spacer(flex: 2),//                               Stack(//                                 alignment: Alignment.center,//                                 children: [//                                   Image.asset(//                                     "assets/icons/ic_oval.png",//                                     height: 52,//                                     width: 52,//                                   ),//                                   IconButton(//                                     icon: Icon(//                                       _isPlaying//                                           ? Icons.pause_rounded//                                           : Icons.play_arrow_rounded,//                                       color: const Color(0xFFF26B6C),//                                     ),//                                     onPressed: () {//                                       setState(() {//                                         _isPlaying = !_isPlaying;////                                         if (_isPlaying == false) {//                                           _audioPlayer.pause();//                                         } else {//                                           if (currentBook != null &&//                                               currentBook!.audio != null &&//                                               currentBook!.audio!.isNotEmpty &&//                                               _isPlaying == true) {//                                             _repository//                                                 .getAudioDownloadURL(//                                                     currentBook!.audio![0])//                                                 .then((url) {//                                               _audioPlayer.play(UrlSource(url));//                                             }).catchError((error) {//                                               print(//                                                   'Error playing audio: $error');//                                             });//                                           }//                                         }//                                       });//                                     },//                                   ),//                                 ],//                               ),//                               const Spacer(flex: 2),//                               InkWell(//                                   onTap: () {//                                     final newPosition =//                                         _position + const Duration(seconds: 10);//                                     _audioPlayer.seek(newPosition);//                                     setState(() {//                                       _position = newPosition;//                                     });//                                   },//                                   child: Image.asset("assets/icons/ic_more.png",//                                       height: 14,//                                       width: 20,//                                       color: MyPreferences.getTheme() == true//                                           ? Colors.white//                                           : Colors.black)),//                               const Spacer(),//                               InkWell(//                                 onTap: () {},//                                 child: Image.asset("assets/icons/ic_next.png",//                                     height: 16,//                                     width: 14,//                                     color: MyPreferences.getTheme() == true//                                         ? Colors.white//                                         : Colors.black),//                               ),//                             ],//                           ),//                         ),//                       ],//                     ),//                   ),//                 ),//               ],//             ),//           );//         },//       ),//     );//   }// }